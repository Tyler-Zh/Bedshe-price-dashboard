<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bedsure Portfolio Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Wayfair Palettes */
        .wf-classic-dark-purple { color: #520F54; }
        .wf-classic-dark-teal { color: #01768B; }
        .wf-classic-light-green { color: #82D170; }
        .wf-orange { color: #FB7E00; }
        .bg-wf-classic-dark-purple { background-color: #520F54; }
        .bg-wf-classic-light-purple { background-color: #C98DC5; }
        .bg-wf-classic-dark-teal { background-color: #01768B; }
        .bg-wf-classic-light-teal { background-color: #84C6D1; }
        .bg-wf-classic-lime-green { background-color: #C6D636; }
        .bg-wf-classic-light-green { background-color: #82D170; }
        .bg-wf-classic-yellow { background-color: #F8CF1C; }
        .bg-wf-secondary-red { background-color: #990E35; }
        .bg-wf-secondary-pink { background-color: #DC647E; }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .kpi-card {
            border-left-width: 4px;
            transition: all 0.3s ease-in-out;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        h2 {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1.75rem;
            font-weight: 700;
            color: #374151;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg p-6 sm:p-8">
        <!-- Header -->
        <header class="text-center pb-6 mb-8">
            <h1 class="text-5xl font-bold text-gray-800">Bedsure Portfolio Analysis</h1>
            <p class="text-xl text-gray-500 mt-2">Margin, Competitiveness, and Performance Overview</p>
        </header>

        <!-- Headline Numbers -->
        <section id="headline-numbers" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <div class="kpi-card bg-gray-50 rounded-lg p-5 border-l-wf-classic-dark-teal shadow-sm">
                <h3 class="text-md font-semibold text-gray-500">Overall Weighted Margin</h3>
                <p id="total-margin" class="text-4xl font-bold wf-classic-dark-teal mt-1"></p>
            </div>
            <div class="kpi-card bg-gray-50 rounded-lg p-5 border-l-wf-classic-dark-purple shadow-sm">
                <h3 class="text-md font-semibold text-gray-500">Total Revenue (WSC L12M)</h3>
                <p id="total-revenue" class="text-4xl font-bold wf-classic-dark-purple mt-1"></p>
            </div>
            <div class="kpi-card bg-gray-50 rounded-lg p-5 border-l-wf-classic-light-green shadow-sm">
                <h3 class="text-md font-semibold text-gray-500">Total Products Analyzed</h3>
                <p id="total-products" class="text-4xl font-bold wf-classic-light-green mt-1"></p>
            </div>
            <div class="kpi-card bg-gray-50 rounded-lg p-5 border-l-wf-orange shadow-sm">
                <h3 class="text-md font-semibold text-gray-500">Total Competitiveness</h3>
                <p id="total-competitiveness" class="text-4xl font-bold wf-orange mt-1"></p>
            </div>
        </section>

        <!-- Ship Lane & Competitor Matching Analysis -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-12">
            <div>
                <h2>Ship Lane Analysis: CG vs DS</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-4 font-semibold text-gray-600 rounded-tl-lg">Metric</th>
                                <th class="p-4 font-semibold text-gray-600 text-center">CastleGate (CG)</th>
                                <th class="p-4 font-semibold text-gray-600 text-center rounded-tr-lg">DropShip (DS)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr>
                                <td class="p-4 font-medium">Total Part Numbers</td>
                                <td id="cg-parts" class="p-4 text-center text-lg font-semibold"></td>
                                <td id="ds-parts" class="p-4 text-center text-lg font-semibold"></td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Total Revenue</td>
                                <td id="cg-revenue" class="p-4 text-center text-lg font-semibold"></td>
                                <td id="ds-revenue" class="p-4 text-center text-lg font-semibold"></td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Weighted Margin</td>
                                <td id="cg-margin" class="p-4 text-center text-lg font-semibold"></td>
                                <td id="ds-margin" class="p-4 text-center text-lg font-semibold"></td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Competitiveness</td>
                                <td id="cg-competitiveness" class="p-4 text-center text-lg font-semibold"></td>
                                <td id="ds-competitiveness" class="p-4 text-center text-lg font-semibold"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div>
                <h2>Competitor Price Matching</h2>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <h3 class="font-semibold text-gray-600 mb-2">Part # Share</h3>
                        <div class="chart-container mx-auto" style="height: 150px; width: 150px;"><canvas id="parts-share-chart"></canvas></div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-600 mb-2">Revenue Share</h3>
                        <div class="chart-container mx-auto" style="height: 150px; width: 150px;"><canvas id="revenue-share-chart"></canvas></div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-600 mb-2">Margin Share</h3>
                        <div class="chart-container mx-auto" style="height: 150px; width: 150px;"><canvas id="margin-share-chart"></canvas></div>
                    </div>
                </div>
                <div class="mt-4 bg-gray-50 rounded-lg p-4 flex justify-around">
                    <div>
                        <span class="text-gray-500">Margin (Matched): </span>
                        <span id="matched-margin" class="font-bold text-lg"></span>
                    </div>
                    <div>
                        <span class="text-gray-500">Margin (Unmatched): </span>
                        <span id="unmatched-margin" class="font-bold text-lg"></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Competitiveness by Price Tier -->
        <section class="mb-12">
            <h2>Competitiveness & Margin by Price Tier</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="p-4 font-semibold text-gray-600 rounded-tl-lg">Price Tier</th>
                            <th class="p-4 font-semibold text-gray-600 text-center"># of Parts</th>
                            <th class="p-4 font-semibold text-gray-600 text-center">WSC Weight %</th>
                            <th class="p-4 font-semibold text-gray-600 text-center">Competitiveness %</th>
                            <th class="p-4 font-semibold text-gray-600 text-center rounded-tr-lg">Margin %</th>
                        </tr>
                    </thead>
                    <tbody id="competitiveness-by-price-tier-table" class="divide-y">
                        <!-- Rows will be injected by JS -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Contribution by Margin Tier -->
        <section class="mb-12">
            <h2>Contribution by Margin Tier</h2>
            <table class="w-full text-left">
                <thead class="border-b">
                    <tr>
                        <th class="pb-2 font-semibold text-gray-600">Margin Tier</th>
                        <th class="pb-2 font-semibold text-gray-600 text-center">% Parts</th>
                        <th class="pb-2 font-semibold text-gray-600 text-center">% Revenue</th>
                        <th class="pb-2 font-semibold text-gray-600 text-center">Weighted Margin</th>
                        <th class="pb-2 font-semibold text-gray-600 text-center" style="width: 20%;">% Margin Contribution</th>
                    </tr>
                </thead>
                <tbody id="contribution-margin-tier-table">
                    <!-- Rows will be injected by JS -->
                </tbody>
            </table>
        </section>

        <!-- Low Margin Analysis -->
        <section class="mb-12">
            <h2>Low Margin Analysis (Below 0%) by Price Tier</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-red-100">
                        <tr>
                            <th class="p-4 font-semibold text-red-800 rounded-tl-lg">Price Tier</th>
                            <th class="p-4 font-semibold text-red-800 text-center"># of Parts</th>
                            <th class="p-4 font-semibold text-red-800 text-center">Total Revenue (WSC)</th>
                            <th class="p-4 font-semibold text-red-800 text-center">Total Profit Loss</th>
                            <th class="p-4 font-semibold text-red-800 text-center rounded-tr-lg">Weighted Margin %</th>
                        </tr>
                    </thead>
                    <tbody id="low-margin-analysis-table" class="divide-y">
                        <!-- Rows will be injected by JS -->
                    </tbody>
                    <tfoot class="bg-gray-100 font-bold">
                        <tr>
                            <td class="p-4 rounded-bl-lg">Total</td>
                            <td id="low-margin-total-parts" class="p-4 text-center"></td>
                            <td id="low-margin-total-revenue" class="p-4 text-center"></td>
                            <td id="low-margin-total-profit" class="p-4 text-center text-red-600"></td>
                            <td id="low-margin-total-margin" class="p-4 text-center text-red-600 rounded-br-lg"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <!-- Detailed Margin Breakdowns -->
        <section class="mb-12">
            <div class="grid grid-cols-1">
                <h2 class="text-center">Margin & Price Tier - Matched</h2>
                <div class="chart-container"><canvas id="marginPriceTierMatchedChart"></canvas></div>
            </div>
        </section>

        <!-- Pricing Strategy Analysis - Matched Products -->
        <section class="mb-12">
            <h2>Pricing Strategy Analysis - Matched Products</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-4 font-semibold text-gray-600 rounded-tl-lg">Pricing Strategy</th>
                                <th class="p-4 font-semibold text-gray-600 text-right"># Parts</th>
                                <th class="p-4 font-semibold text-gray-600 text-right rounded-tr-lg">Margin %</th>
                            </tr>
                        </thead>
                        <tbody id="pricing-strategy-table" class="divide-y">
                            <!-- Rows will be injected by JS -->
                        </tbody>
                    </table>
                </div>
                 <div class="chart-container"><canvas id="pricingStrategyByPriceTierChart"></canvas></div>
            </div>
        </section>
    </div>

    <script>
        const infographicData = {
            "headline_numbers": {
                "overall_weighted_margin": 0.12784841771195616,
                "total_revenue": 3009684.7000000006,
                "total_products_analyzed": 9593,
                "total_competitiveness": 77.13098591549296
            },
            "ship_lane_analysis": [
                {
                    "lane": "DS",
                    "parts": 9215,
                    "revenue": 2337060.4431,
                    "weighted_margin": 0.10986348625904374,
                    "revenue_percent": 0.7765103009591465
                },
                {
                    "lane": "CG",
                    "parts": 378,
                    "revenue": 672624.2589,
                    "weighted_margin": 0.18871407077677353,
                    "revenue_percent": 0.22348969904085352
                }
            ],
            "competitor_matching_analysis": {
                "partNumbers": [
                    {
                        "category": "Matched",
                        "value": 5402
                    },
                    {
                        "category": "Unmatched",
                        "value": 4191
                    }
                ],
                "revenue": [
                    {
                        "category": "Matched",
                        "value": 2753415.7831000004
                    },
                    {
                        "category": "Unmatched",
                        "value": 256268.9169
                    }
                ],
                "margin": [
                    {
                        "category": "Matched",
                        "value": 309328.7997972051
                    },
                    {
                        "category": "Unmatched",
                        "value": 75112.92388047022
                    }
                ],
                "totalRevenue": 3009684.7000000006,
                "totalMargin": 384441.7236776753
            },
            "competitiveness_by_price_tier": [
                {
                    "Price Tier": "$0 ~ $20",
                    "parts": 634,
                    "revenue": 75775.2977,
                    "wsc_weight_percent": 0.02517616198642735,
                    "competitiveness_percent": 53.62776859504132,
                    "weighted_margin": -0.0195616584067307
                },
                {
                    "Price Tier": "$20 ~ $35",
                    "parts": 1968,
                    "revenue": 403889.3248,
                    "wsc_weight_percent": 0.1342084511528659,
                    "competitiveness_percent": 75.76625805587784,
                    "weighted_margin": 0.06583921768817757
                },
                {
                    "Price Tier": "$35 ~ $60",
                    "parts": 4134,
                    "revenue": 1683050.2925,
                    "wsc_weight_percent": 0.559281735166415,
                    "competitiveness_percent": 81.33202973149864,
                    "weighted_margin": 0.0858482012921208
                },
                {
                    "Price Tier": "$60 ~ $90",
                    "parts": 1965,
                    "revenue": 667389.0205,
                    "wsc_weight_percent": 0.2217431110036662,
                    "competitiveness_percent": 78.77862595419847,
                    "weighted_margin": 0.1798363673539167
                },
                {
                    "Price Tier": "$90+",
                    "parts": 892,
                    "revenue": 180295.6645,
                    "wsc_weight_percent": 0.0595905406906256,
                    "competitiveness_percent": 74.32786885245902,
                    "weighted_margin": 0.23351989060594833
                }
            ],
            "contribution_by_margin_tier": [
                {
                    "Margin Tier": "Below -11%",
                    "part_count": 220,
                    "revenue": 62299.7314,
                    "margin_contribution_dollars": -7277.925203378544,
                    "part_count_percent": 0.022933388929427696,
                    "revenue_percent": 0.0206979606975263,
                    "margin_percent": -0.01893322421381397,
                    "weighted_margin": -0.11681283307616654
                },
                {
                    "Margin Tier": "-11% ~ 0%",
                    "part_count": 1756,
                    "revenue": 880292.0594000001,
                    "margin_contribution_dollars": -66318.99592477141,
                    "part_count_percent": 0.18304910810903784,
                    "revenue_percent": 0.2925916892556778,
                    "margin_percent": -0.1725287038162234,
                    "weighted_margin": -0.07533728646199343
                },
                {
                    "Margin Tier": "0% ~ 10%",
                    "part_count": 1007,
                    "revenue": 587823.136,
                    "margin_contribution_dollars": 28640.403803135967,
                    "part_count_percent": 0.10497237569060357,
                    "revenue_percent": 0.1953210350791223,
                    "margin_percent": 0.07450379469792613,
                    "weighted_margin": 0.04872166946685822
                },
                {
                    "Margin Tier": "10% ~ 18%",
                    "part_count": 786,
                    "revenue": 376041.51780000004,
                    "margin_contribution_dollars": 51225.59250047321,
                    "part_count_percent": 0.08193474408422808,
                    "revenue_percent": 0.12494958043661109,
                    "margin_percent": 0.13324622174351052,
                    "weighted_margin": 0.1362244265008544
                },
                {
                    "Margin Tier": "18% ~ 28%",
                    "part_count": 1989,
                    "revenue": 543033.4074999999,
                    "margin_contribution_dollars": 133544.75549007416,
                    "part_count_percent": 0.2073386844574169,
                    "revenue_percent": 0.18043801533276994,
                    "margin_percent": 0.3473767215902094,
                    "weighted_margin": 0.2459240428315181
                },
                {
                    "Margin Tier": "28% Above",
                    "part_count": 3835,
                    "revenue": 560274.8569,
                    "margin_contribution_dollars": 204327.9949615655,
                    "part_count_percent": 0.39977066611070573,
                    "revenue_percent": 0.18615171929834255,
                    "margin_percent": 0.5309351899974558,
                    "weighted_margin": 0.36469032658820054
                }
            ],
            "low_margin_analysis": [
                {
                    "Price Tier": "$0 ~ $20",
                    "parts": 393,
                    "revenue": 49988.5714,
                    "profit_loss": -4460.985699440616
                },
                {
                    "Price Tier": "$20 ~ $35",
                    "parts": 596,
                    "revenue": 175422.9691,
                    "profit_loss": -12968.714571732924
                },
                {
                    "Price Tier": "$35 ~ $60",
                    "parts": 885,
                    "revenue": 573043.3932,
                    "profit_loss": -40859.45892552636
                },
                {
                    "Price Tier": "$60 ~ $90",
                    "parts": 100,
                    "revenue": 94248.9142,
                    "profit_loss": -6725.577232230303
                },
                {
                    "Price Tier": "$90+",
                    "parts": 10,
                    "revenue": 16013.8821,
                    "profit_loss": -1201.914757313889
                },
                {
                    "Price Tier": "Total",
                    "parts": 1984,
                    "revenue": 908717.7300999998,
                    "profit_loss": -66216.65113624408
                }
            ],
            "charts": {
                "marginPriceTierMatched": {
                    "labels": [
                        "$0 ~ $20",
                        "$20 ~ $35",
                        "$35 ~ $60",
                        "$60 ~ $90",
                        "$90+"
                    ],
                    "datasets": [
                        {
                            "label": "Below -11%",
                            "data": [
                                96,
                                73,
                                51,
                                0,
                                0
                            ]
                        },
                        {
                            "label": "-11% ~ 0%",
                            "data": [
                                293,
                                523,
                                834,
                                100,
                                10
                            ]
                        },
                        {
                            "label": "0% ~ 10%",
                            "data": [
                                77,
                                294,
                                499,
                                108,
                                14
                            ]
                        },
                        {
                            "label": "10% ~ 18%",
                            "data": [
                                27,
                                255,
                                343,
                                114,
                                33
                            ]
                        },
                        {
                            "label": "18% ~ 28%",
                            "data": [
                                24,
                                284,
                                458,
                                205,
                                64
                            ]
                        },
                        {
                            "label": "28% Above",
                            "data": [
                                40,
                                209,
                                523,
                                521,
                                335
                            ]
                        }
                    ]
                },
                "pricingStrategyByPriceTier": {
                    "labels": [
                        "$0 ~ $20",
                        "$20 ~ $35",
                        "$35 ~ $60",
                        "$60 ~ $90",
                        "$90+"
                    ],
                    "datasets": [
                        {
                            "label": "BrandedPromoPassthroughHandler",
                            "data": [
                                517,
                                1331,
                                2246,
                                625,
                                218
                            ]
                        },
                        {
                            "label": "PiEpsilonHandler",
                            "data": [
                                26,
                                150,
                                347,
                                355,
                                204
                            ]
                        },
                        {
                            "label": "FixedTakeRateHandler",
                            "data": [
                                0,
                                0,
                                7,
                                25,
                                25
                            ]
                        },
                        {
                            "label": "MapOHandler",
                            "data": [
                                11,
                                29,
                                32,
                                13,
                                2
                            ]
                        },
                        {
                            "label": "CompetitorTargetPriceHandler",
                            "data": [
                                3,
                                128,
                                71,
                                11,
                                0
                            ]
                        }
                    ]
                }
            },
            "pricingStrategyAnalysis": [
                {
                    "Pricing Strategy (Handler)": "BrandedPromoPassthroughHandler",
                    "parts": 4960,
                    "margin": 0.0886129828236111
                },
                {
                    "Pricing Strategy (Handler)": "PiEpsilonHandler",
                    "parts": 4109,
                    "margin": 0.16541604085427974
                },
                {
                    "Pricing Strategy (Handler)": "FixedTakeRateHandler",
                    "parts": 258,
                    "margin": 0.19832791550965354
                },
                {
                    "Pricing Strategy (Handler)": "MapOHandler",
                    "parts": 113,
                    "margin": 0.32049971932332617
                },
                {
                    "Pricing Strategy (Handler)": "CompetitorTargetPriceHandler",
                    "parts": 85,
                    "margin": 0.021087851608750823
                }
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            // --- Populate Data ---
            // Headline Numbers
            document.getElementById('total-margin').textContent = (infographicData.headline_numbers.overall_weighted_margin * 100).toFixed(2) + '%';
            document.getElementById('total-revenue').textContent = '$' + infographicData.headline_numbers.total_revenue.toLocaleString();
            document.getElementById('total-products').textContent = infographicData.headline_numbers.total_products_analyzed.toLocaleString();
            document.getElementById('total-competitiveness').textContent = infographicData.headline_numbers.total_competitiveness.toFixed(2) + '%';

            // Ship Lane Analysis
            const cgData = infographicData.ship_lane_analysis.find(d => d.lane === 'CG');
            const dsData = infographicData.ship_lane_analysis.find(d => d.lane === 'DS');
            document.getElementById('cg-parts').textContent = cgData.parts.toLocaleString();
            document.getElementById('cg-revenue').textContent = '$' + cgData.revenue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('cg-margin').textContent = (cgData.weighted_margin * 100).toFixed(2) + '%';
            document.getElementById('ds-parts').textContent = dsData.parts.toLocaleString();
            document.getElementById('ds-revenue').textContent = '$' + dsData.revenue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('ds-margin').textContent = (dsData.weighted_margin * 100).toFixed(2) + '%';
            
            // Competitiveness is a portfolio-wide calculation, not per ship lane.
            // The provided template has a spot for this, but the logic is flawed as per the prompt.
            // The prompt requests the portfolio competitiveness percentage, which is a single number.
            // I will use a different approach here to provide the data from my calculations.
            // I will remove these as they are not accurate based on the prompt's definition.
            // document.getElementById('cg-competitiveness').textContent = cgData.competitiveness.toFixed(2) + '%';
            // document.getElementById('ds-competitiveness').textContent = dsData.competitiveness.toFixed(2) + '%';
            // Instead, I'll update the competitive matching analysis to be more detailed
            document.getElementById('matched-margin').textContent = (infographicData.competitor_matching_analysis.revenue.find(d => d.category === 'Matched').value * infographicData.pricingStrategyAnalysis.find(d => d['Pricing Strategy (Handler)'] === 'BrandedPromoPassthroughHandler').margin * 100 / infographicData.competitor_matching_analysis.revenue.find(d => d.category === 'Matched').value).toFixed(2) + '%';
            
            const matchedRev = infographicData.competitor_matching_analysis.revenue.find(d => d.category === 'Matched').value;
            const unmatchedRev = infographicData.competitor_matching_analysis.revenue.find(d => d.category === 'Unmatched').value;
            const matchedMarg = infographicData.competitor_matching_analysis.margin.find(d => d.category === 'Matched').value;
            const unmatchedMarg = infographicData.competitor_matching_analysis.margin.find(d => d.category === 'Unmatched').value;

            document.getElementById('matched-margin').textContent = (matchedMarg/matchedRev * 100).toFixed(2) + '%';
            document.getElementById('unmatched-margin').textContent = (unmatchedMarg/unmatchedRev * 100).toFixed(2) + '%';


            // Competitiveness by Price Tier Table
            const competitivenessTableBody = document.getElementById('competitiveness-by-price-tier-table');
            infographicData.competitiveness_by_price_tier.forEach(row => {
                 const tr = document.createElement('tr');
                 tr.innerHTML = `
                    <td class="p-4 font-medium">${row['Price Tier']}</td>
                    <td class="p-4 text-center">${row.parts.toLocaleString()}</td>
                    <td class="p-4 text-center font-semibold">${(row.wsc_weight_percent * 100).toFixed(2)}%</td>
                    <td class="p-4 text-center font-semibold">${row.competitiveness_percent.toFixed(2)}%</td>
                    <td class="p-4 text-center font-semibold">${(row.weighted_margin * 100).toFixed(2)}%</td>
                `;
                competitivenessTableBody.appendChild(tr);
            });

            // Contribution by Margin Tier Table
            const contributionTableBody = document.getElementById('contribution-margin-tier-table');
            const totalMarginContribution = infographicData.contribution_by_margin_tier.reduce((sum, item) => sum + item.margin_contribution_dollars, 0);
            
            infographicData.contribution_by_margin_tier.forEach(row => {
                const tr = document.createElement('tr');
                const marginShare = (row.margin_contribution_dollars / totalMarginContribution) * 100;
                const barWidth = Math.abs(marginShare);
                const barColor = marginShare < 0 ? '#DC647E' : '#01768B';
                const marginLeft = marginShare < 0 ? 50 - barWidth/2 : 50;
                
                tr.innerHTML = `
                    <td class="py-3">${row['Margin Tier']}</td>
                    <td class="py-3 text-center">${(row.part_count_percent * 100).toFixed(2)}%</td>
                    <td class="py-3 text-center">${(row.revenue_percent * 100).toFixed(2)}%</td>
                    <td class="py-3 text-center font-semibold">${(row.weighted_margin * 100).toFixed(2)}%</td>
                    <td class="py-3 text-center relative">
                        <span>${marginShare.toFixed(2)}%</span>
                        <div class="absolute bottom-1 left-0 w-full h-1.5 bg-gray-200 rounded">
                           <div class="h-1.5 rounded" style="width: ${barWidth/2}%; background-color: ${barColor}; margin-left: ${marginShare < 0 ? 'auto' : 50}%; margin-right: ${marginShare < 0 ? 50 : 'auto'}%;"></div>
                        </div>
                    </td>
                `;
                contributionTableBody.appendChild(tr);
            });

            // Low Margin Analysis Table
            const lowMarginTableBody = document.getElementById('low-margin-analysis-table');
            infographicData.low_margin_analysis.slice(0, -1).forEach(row => {
                 const tr = document.createElement('tr');
                 const weightedMargin = row.profit_loss / row.revenue;
                 tr.innerHTML = `
                    <td class="p-4 font-medium">${row['Price Tier']}</td>
                    <td class="p-4 text-center">${row.parts.toLocaleString()}</td>
                    <td class="p-4 text-center">${'$' + row.revenue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td class="p-4 text-center font-semibold text-red-600">${'$' + row.profit_loss.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td class="p-4 text-center font-semibold text-red-600">${(weightedMargin * 100).toFixed(2)}%</td>
                `;
                lowMarginTableBody.appendChild(tr);
            });
            const totalData = infographicData.low_margin_analysis.slice(-1)[0];
            const totalWeightedMargin = totalData.profit_loss / totalData.revenue;
            document.getElementById('low-margin-total-parts').textContent = totalData.parts.toLocaleString();
            document.getElementById('low-margin-total-revenue').textContent = '$' + totalData.revenue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('low-margin-total-profit').textContent = '$' + totalData.profit_loss.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('low-margin-total-margin').textContent = (totalWeightedMargin * 100).toFixed(2) + '%';


            // Pricing Strategy Table
            const pricingTableBody = document.getElementById('pricing-strategy-table');
            infographicData.pricingStrategyAnalysis.forEach(row => {
                if (row['Pricing Strategy (Handler)']) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="p-4 font-medium">${row['Pricing Strategy (Handler)']}</td>
                        <td class="p-4 text-right">${row.parts.toLocaleString()}</td>
                        <td class="p-4 text-right font-semibold">${(row.margin * 100).toFixed(2)}%</td>
                    `;
                    pricingTableBody.appendChild(tr);
                }
            });

            // --- Initialize Charts ---
            const doughnutOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, padding: 15 } } },
                cutout: '60%'
            };
            
            const matchedParts = infographicData.competitor_matching_analysis.partNumbers.find(d => d.category === 'Matched').value;
            const unmatchedParts = infographicData.competitor_matching_analysis.partNumbers.find(d => d.category === 'Unmatched').value;
            const matchedRevenue = infographicData.competitor_matching_analysis.revenue.find(d => d.category === 'Matched').value;
            const unmatchedRevenue = infographicData.competitor_matching_analysis.revenue.find(d => d.category === 'Unmatched').value;
            const matchedMarginDollars = infographicData.competitor_matching_analysis.margin.find(d => d.category === 'Matched').value;
            const unmatchedMarginDollars = infographicData.competitor_matching_analysis.margin.find(d => d.category === 'Unmatched').value;
            const totalMarginDollars = matchedMarginDollars + unmatchedMarginDollars;
            
            new Chart(document.getElementById('parts-share-chart').getContext('2d'), {
                type: 'doughnut',
                data: { labels: ['Matched', 'Unmatched'], datasets: [{ data: [matchedParts, unmatchedParts], backgroundColor: ['#01768B', '#84C6D1'] }] },
                options: doughnutOptions
            });
            new Chart(document.getElementById('revenue-share-chart').getContext('2d'), {
                type: 'doughnut',
                data: { labels: ['Matched', 'Unmatched'], datasets: [{ data: [matchedRevenue, unmatchedRevenue], backgroundColor: ['#7F187F', '#C98DC5'] }] },
                options: doughnutOptions
            });
            new Chart(document.getElementById('margin-share-chart').getContext('2d'), {
                type: 'doughnut',
                data: { labels: ['Matched', 'Unmatched'], datasets: [{ data: [matchedMarginDollars, unmatchedMarginDollars], backgroundColor: ['#82D170', '#C6D636'] }] },
                options: doughnutOptions
            });
            
            const wayfairClassicPalette = ['#7F187F', '#C98DC5', '#01768B', '#84C6D1', '#C6D636', '#82D170', '#F8CF1C'];
            const marginTierColors = ['#990E35', '#DC647E', '#F8CF1C', '#82D170', '#84C6D1', '#01768B'];

            new Chart(document.getElementById('pricingStrategyByPriceTierChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: infographicData.charts.pricingStrategyByPriceTier.labels,
                    datasets: infographicData.charts.pricingStrategyByPriceTier.datasets.map((ds, i) => ({...ds, backgroundColor: wayfairClassicPalette[i % wayfairClassicPalette.length]}))
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { x: { stacked: true, title: { display: true, text: 'Price Tier'} }, y: { stacked: true, beginAtZero: true, title: { display: true, text: '# of Products' } } },
                    plugins: { legend: { position: 'top' } }
                }
            });

            new Chart(document.getElementById('marginPriceTierMatchedChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: infographicData.charts.marginPriceTierMatched.labels,
                    datasets: infographicData.charts.marginPriceTierMatched.datasets.map((ds, i) => ({...ds, backgroundColor: marginTierColors[i % marginTierColors.length]}))
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { x: { stacked: true, title: { display: true, text: 'Price Tier'} }, y: { stacked: true, beginAtZero: true, title: { display: true, text: '# of Products' } } },
                    plugins: { legend: { position: 'top', labels: { boxWidth: 10, font: { size: 10 } } } }
                }
            });
        });
    </script>
</body>
</html>
